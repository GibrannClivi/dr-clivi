/Users/gibrann/Documents/adk-samples/python/agents/dr-clivi/telegram_main.py:46: DeprecationWarning: 
        on_event is deprecated, use lifespan event handlers instead.

        Read more about it in the
        [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
        
  @app.on_event("startup")
INFO:     Will watch for changes in these directories: ['/Users/gibrann/Documents/adk-samples/python/agents/dr-clivi']
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [36426] using StatReload
ü§ñ Starting Dr. Clivi Telegram Bot...
üì± Ready for Telegram integration
üè• Hybrid medical assistance with ADK architecture

Available endpoints:
  GET  /health - Health check
  POST /telegram/webhook - Main webhook (configure with Telegram)
  POST /telegram/set_webhook - Helper to configure webhook
  DELETE /telegram/webhook - Helper to remove webhook

INFO:     Started server process [36494]
INFO:     Waiting for application startup.
2025-07-01 09:52:47,626 - DialogflowPageImplementor - INFO - All 23 pages validated successfully
2025-07-01 09:52:47,629 - telegram_main - INFO - Dr. Clivi Telegram Bot initialized successfully
2025-07-01 09:52:47,629 - telegram_main - INFO - Ready to receive webhooks for bot token: 8050517158...
INFO:     Application startup complete.
INFO:     127.0.0.1:57312 - "GET /health HTTP/1.1" 200 OK
2025-07-01 09:53:43,732 - telegram_main - INFO - Received Telegram update: 2537066
2025-07-01 09:53:43,732 - dr_clivi.telegram.telegram_handler - INFO - Processing message from user 1103089805: hola
2025-07-01 09:53:43,732 - dr_clivi.telegram.telegram_handler - INFO - Sending response type 'whatsapp_menu' to chat 1103089805
2025-07-01 09:53:44,531 - httpx - INFO - HTTP Request: POST https://api.telegram.org/bot8050517158:AAFiDe82GbU--eGx6NH0v96rr9FhklrFgoE/sendMessage "HTTP/1.1 200 OK"
INFO:     91.108.5.20:0 - "POST /telegram/webhook HTTP/1.1" 200 OK
2025-07-01 09:53:47,098 - telegram_main - INFO - Received Telegram update: 2537067
2025-07-01 09:53:47,099 - dr_clivi.telegram.telegram_handler - INFO - Processing callback from user 1103089805: MEASUREMENTS_REPORT
2025-07-01 09:53:47,844 - httpx - INFO - HTTP Request: POST https://api.telegram.org/bot8050517158:AAFiDe82GbU--eGx6NH0v96rr9FhklrFgoE/answerCallbackQuery "HTTP/1.1 200 OK"
2025-07-01 09:53:47,845 - dr_clivi.agents.coordinator - INFO - Logging event: {'function_name': 'ACTIVITY_EVENT_LOG', 'params': {'eventType': 'CLICKED_BUTTON_MAIN_MENU'}}
2025-07-01 09:53:47,845 - dr_clivi.telegram.telegram_handler - INFO - Sending response type 'page_navigation' to chat 1103089805
2025-07-01 09:53:47,845 - dr_clivi.telegram.telegram_handler - INFO - Enviando men√∫ paginado a chat 1103089805
2025-07-01 09:53:48,586 - httpx - INFO - HTTP Request: POST https://api.telegram.org/bot8050517158:AAFiDe82GbU--eGx6NH0v96rr9FhklrFgoE/sendMessage "HTTP/1.1 200 OK"
INFO:     91.108.5.20:0 - "POST /telegram/webhook HTTP/1.1" 200 OK
2025-07-01 09:53:53,033 - telegram_main - INFO - Received Telegram update: 2537068
2025-07-01 09:53:53,033 - dr_clivi.telegram.telegram_handler - INFO - Processing callback from user 1103089805: MEASUREMENTS
2025-07-01 09:53:53,762 - httpx - INFO - HTTP Request: POST https://api.telegram.org/bot8050517158:AAFiDe82GbU--eGx6NH0v96rr9FhklrFgoE/answerCallbackQuery "HTTP/1.1 200 OK"
2025-07-01 09:53:53,763 - dr_clivi.agents.coordinator - INFO - Logging event: {'function_name': 'ACTIVITY_EVENT_LOG', 'params': {'eventType': 'CLICKED_BUTTON_MAIN_MENU'}}
2025-07-01 09:53:53,763 - dr_clivi.telegram.telegram_handler - INFO - Sending response type 'page_navigation' to chat 1103089805
2025-07-01 09:53:53,763 - dr_clivi.telegram.telegram_handler - INFO - Enviando men√∫ paginado a chat 1103089805
2025-07-01 09:53:54,502 - httpx - INFO - HTTP Request: POST https://api.telegram.org/bot8050517158:AAFiDe82GbU--eGx6NH0v96rr9FhklrFgoE/sendMessage "HTTP/1.1 200 OK"
INFO:     91.108.5.20:0 - "POST /telegram/webhook HTTP/1.1" 200 OK
2025-07-01 09:53:56,727 - telegram_main - INFO - Received Telegram update: 2537069
2025-07-01 09:53:56,728 - dr_clivi.telegram.telegram_handler - INFO - Processing callback from user 1103089805: LOG_GLUCOSE_FASTING
2025-07-01 09:53:57,464 - httpx - INFO - HTTP Request: POST https://api.telegram.org/bot8050517158:AAFiDe82GbU--eGx6NH0v96rr9FhklrFgoE/answerCallbackQuery "HTTP/1.1 200 OK"
2025-07-01 09:53:57,464 - dr_clivi.telegram.telegram_handler - INFO - Sending response type 'general_response' to chat 1103089805
2025-07-01 09:53:58,200 - httpx - INFO - HTTP Request: POST https://api.telegram.org/bot8050517158:AAFiDe82GbU--eGx6NH0v96rr9FhklrFgoE/sendMessage "HTTP/1.1 200 OK"
INFO:     91.108.5.20:0 - "POST /telegram/webhook HTTP/1.1" 200 OK
2025-07-01 09:54:01,482 - telegram_main - INFO - Received Telegram update: 2537070
2025-07-01 09:54:01,482 - dr_clivi.telegram.telegram_handler - INFO - Processing message from user 1103089805: 90
2025-07-01 09:54:01,482 - dr_clivi.tools.generative_ai - INFO - Processing generative AI request for user 1103089805
2025-07-01 09:54:02,490 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-07-01 09:54:04,717 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent "HTTP/1.1 200 OK"
2025-07-01 09:54:04,718 - google_genai.models - INFO - AFC remote call 1 is done.
2025-07-01 09:54:04,719 - dr_clivi.tools.generative_ai - INFO - Gemini API successful response for user 1103089805 in 2.23s
2025-07-01 09:54:04,721 - dr_clivi.tools.generative_ai - INFO - Generative AI response generated for user 1103089805
2025-07-01 09:54:04,721 - DiabetesAgent - INFO - Processing diabetes query for user 1103089805: 90
2025-07-01 09:54:04,721 - dr_clivi.telegram.telegram_handler - INFO - Sending response type 'specialist_response' to chat 1103089805
2025-07-01 09:54:05,347 - httpx - INFO - HTTP Request: POST https://api.telegram.org/bot8050517158:AAFiDe82GbU--eGx6NH0v96rr9FhklrFgoE/sendMessage "HTTP/1.1 400 Bad Request"
2025-07-01 09:54:05,347 - dr_clivi.telegram.telegram_handler - ERROR - Telegram API HTTP error for sendMessage: 400
2025-07-01 09:54:05,348 - dr_clivi.telegram.telegram_handler - ERROR - Response body: {"ok":false,"error_code":400,"description":"Bad Request: message text is empty"}
2025-07-01 09:54:05,348 - dr_clivi.telegram.telegram_handler - ERROR - Payload sent: {'chat_id': '1103089805', 'text': '', 'parse_mode': 'Markdown'}
INFO:     91.108.5.20:0 - "POST /telegram/webhook HTTP/1.1" 200 OK
WARNING:  StatReload detected changes in 'dr_clivi/flows/deterministic_handler.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [36494]
INFO:     Started server process [37263]
INFO:     Waiting for application startup.
2025-07-01 09:54:16,951 - DialogflowPageImplementor - INFO - All 23 pages validated successfully
2025-07-01 09:54:16,955 - telegram_main - INFO - Dr. Clivi Telegram Bot initialized successfully
2025-07-01 09:54:16,955 - telegram_main - INFO - Ready to receive webhooks for bot token: 8050517158...
INFO:     Application startup complete.
2025-07-01 09:54:31,227 - telegram_main - INFO - Received Telegram update: 2537071
2025-07-01 09:54:31,227 - dr_clivi.telegram.telegram_handler - INFO - Processing callback from user 1103089805: QUESTION_TYPE
2025-07-01 09:54:32,049 - httpx - INFO - HTTP Request: POST https://api.telegram.org/bot8050517158:AAFiDe82GbU--eGx6NH0v96rr9FhklrFgoE/answerCallbackQuery "HTTP/1.1 200 OK"
2025-07-01 09:54:32,051 - dr_clivi.agents.coordinator - INFO - Logging event: {'function_name': 'ACTIVITY_EVENT_LOG', 'params': {'eventType': 'CLICKED_BUTTON_MAIN_MENU'}}
2025-07-01 09:54:32,051 - dr_clivi.telegram.telegram_handler - INFO - Sending response type 'page_navigation' to chat 1103089805
2025-07-01 09:54:32,051 - dr_clivi.telegram.telegram_handler - INFO - Enviando men√∫ paginado a chat 1103089805
2025-07-01 09:54:32,877 - httpx - INFO - HTTP Request: POST https://api.telegram.org/bot8050517158:AAFiDe82GbU--eGx6NH0v96rr9FhklrFgoE/sendMessage "HTTP/1.1 200 OK"
INFO:     91.108.5.20:0 - "POST /telegram/webhook HTTP/1.1" 200 OK
2025-07-01 09:54:48,752 - telegram_main - INFO - Received Telegram update: 2537072
2025-07-01 09:54:48,753 - dr_clivi.telegram.telegram_handler - INFO - Processing callback from user 1103089805: LOG_WEIGHT
2025-07-01 09:54:49,498 - httpx - INFO - HTTP Request: POST https://api.telegram.org/bot8050517158:AAFiDe82GbU--eGx6NH0v96rr9FhklrFgoE/answerCallbackQuery "HTTP/1.1 200 OK"
2025-07-01 09:54:49,500 - dr_clivi.telegram.telegram_handler - INFO - Sending response type 'general_response' to chat 1103089805
2025-07-01 09:54:50,259 - httpx - INFO - HTTP Request: POST https://api.telegram.org/bot8050517158:AAFiDe82GbU--eGx6NH0v96rr9FhklrFgoE/sendMessage "HTTP/1.1 200 OK"
INFO:     91.108.5.20:0 - "POST /telegram/webhook HTTP/1.1" 200 OK
2025-07-01 09:54:53,692 - telegram_main - INFO - Received Telegram update: 2537073
2025-07-01 09:54:53,692 - dr_clivi.telegram.telegram_handler - INFO - Processing message from user 1103089805: 72
2025-07-01 09:54:53,692 - dr_clivi.tools.generative_ai - INFO - Processing generative AI request for user 1103089805
2025-07-01 09:54:54,696 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-07-01 09:54:56,431 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent "HTTP/1.1 200 OK"
2025-07-01 09:54:56,433 - google_genai.models - INFO - AFC remote call 1 is done.
2025-07-01 09:54:56,433 - dr_clivi.tools.generative_ai - INFO - Gemini API successful response for user 1103089805 in 1.74s
2025-07-01 09:54:56,437 - dr_clivi.tools.generative_ai - INFO - Generative AI response generated for user 1103089805
2025-07-01 09:54:56,438 - dr_clivi.telegram.telegram_handler - INFO - Sending response type 'page_navigation' to chat 1103089805
2025-07-01 09:54:56,438 - dr_clivi.telegram.telegram_handler - INFO - Enviando men√∫ paginado a chat 1103089805
2025-07-01 09:54:57,196 - httpx - INFO - HTTP Request: POST https://api.telegram.org/bot8050517158:AAFiDe82GbU--eGx6NH0v96rr9FhklrFgoE/sendMessage "HTTP/1.1 200 OK"
INFO:     91.108.5.20:0 - "POST /telegram/webhook HTTP/1.1" 200 OK
2025-07-01 09:55:18,953 - telegram_main - INFO - Received Telegram update: 2537074
2025-07-01 09:55:18,953 - dr_clivi.telegram.telegram_handler - INFO - Processing message from user 1103089805: hola
2025-07-01 09:55:18,953 - dr_clivi.telegram.telegram_handler - INFO - Sending response type 'whatsapp_menu' to chat 1103089805
2025-07-01 09:55:19,730 - httpx - INFO - HTTP Request: POST https://api.telegram.org/bot8050517158:AAFiDe82GbU--eGx6NH0v96rr9FhklrFgoE/sendMessage "HTTP/1.1 200 OK"
INFO:     91.108.5.20:0 - "POST /telegram/webhook HTTP/1.1" 200 OK
2025-07-01 09:55:22,331 - telegram_main - INFO - Received Telegram update: 2537075
2025-07-01 09:55:22,332 - dr_clivi.telegram.telegram_handler - INFO - Processing callback from user 1103089805: MEASUREMENTS
2025-07-01 09:55:23,071 - httpx - INFO - HTTP Request: POST https://api.telegram.org/bot8050517158:AAFiDe82GbU--eGx6NH0v96rr9FhklrFgoE/answerCallbackQuery "HTTP/1.1 200 OK"
2025-07-01 09:55:23,072 - dr_clivi.agents.coordinator - INFO - Logging event: {'function_name': 'ACTIVITY_EVENT_LOG', 'params': {'eventType': 'CLICKED_BUTTON_MAIN_MENU'}}
2025-07-01 09:55:23,073 - dr_clivi.telegram.telegram_handler - INFO - Sending response type 'page_navigation' to chat 1103089805
2025-07-01 09:55:23,073 - dr_clivi.telegram.telegram_handler - INFO - Enviando men√∫ paginado a chat 1103089805
2025-07-01 09:55:23,863 - httpx - INFO - HTTP Request: POST https://api.telegram.org/bot8050517158:AAFiDe82GbU--eGx6NH0v96rr9FhklrFgoE/sendMessage "HTTP/1.1 200 OK"
INFO:     91.108.5.20:0 - "POST /telegram/webhook HTTP/1.1" 200 OK
2025-07-01 09:55:25,174 - telegram_main - INFO - Received Telegram update: 2537076
2025-07-01 09:55:25,174 - dr_clivi.telegram.telegram_handler - INFO - Processing callback from user 1103089805: LOG_WEIGHT
2025-07-01 09:55:25,919 - httpx - INFO - HTTP Request: POST https://api.telegram.org/bot8050517158:AAFiDe82GbU--eGx6NH0v96rr9FhklrFgoE/answerCallbackQuery "HTTP/1.1 200 OK"
2025-07-01 09:55:25,919 - dr_clivi.telegram.telegram_handler - INFO - Sending response type 'general_response' to chat 1103089805
2025-07-01 09:55:26,654 - httpx - INFO - HTTP Request: POST https://api.telegram.org/bot8050517158:AAFiDe82GbU--eGx6NH0v96rr9FhklrFgoE/sendMessage "HTTP/1.1 200 OK"
INFO:     91.108.5.20:0 - "POST /telegram/webhook HTTP/1.1" 200 OK
2025-07-01 09:55:29,946 - telegram_main - INFO - Received Telegram update: 2537077
2025-07-01 09:55:29,946 - dr_clivi.telegram.telegram_handler - INFO - Processing message from user 1103089805: 80
2025-07-01 09:55:29,946 - dr_clivi.tools.generative_ai - INFO - Processing generative AI request for user 1103089805
2025-07-01 09:55:30,106 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-07-01 09:55:31,551 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent "HTTP/1.1 200 OK"
2025-07-01 09:55:31,565 - google_genai.models - INFO - AFC remote call 1 is done.
2025-07-01 09:55:31,566 - dr_clivi.tools.generative_ai - INFO - Gemini API successful response for user 1103089805 in 1.46s
2025-07-01 09:55:31,570 - dr_clivi.tools.generative_ai - INFO - Generative AI response generated for user 1103089805
2025-07-01 09:55:31,570 - dr_clivi.telegram.telegram_handler - INFO - Sending response type 'page_navigation' to chat 1103089805
2025-07-01 09:55:31,570 - dr_clivi.telegram.telegram_handler - INFO - Enviando men√∫ paginado a chat 1103089805
2025-07-01 09:55:32,314 - httpx - INFO - HTTP Request: POST https://api.telegram.org/bot8050517158:AAFiDe82GbU--eGx6NH0v96rr9FhklrFgoE/sendMessage "HTTP/1.1 200 OK"
INFO:     91.108.5.20:0 - "POST /telegram/webhook HTTP/1.1" 200 OK
